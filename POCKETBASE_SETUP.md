# PocketBase 设置指南

## 🚀 快速设置步骤

### 1. 启动 PocketBase 服务
在 WiseFlow Desktop 应用中：
1. 点击"启动 PocketBase"按钮
2. 等待服务启动完成
3. 确认连接状态显示"已连接"

### 2. 创建管理员账户
1. 打开浏览器访问: http://localhost:8090/_/
2. 首次访问会提示创建管理员账户
3. **重要**: 请使用以下固定账户信息：
   - **邮箱**: `test@example.com`
   - **密码**: `1234567890`
4. 点击"Create Admin"

**注意**: 应用已硬编码使用上述账户进行自动认证，请确保使用相同的邮箱和密码。

### 3. 配置集合权限（可选）
如果需要应用无需认证即可访问数据：

#### 信息源 (sources)
```
列表规则: ""
查看规则: ""
创建规则: ""
更新规则: ""
删除规则: ""
```

#### 关注点 (focus_points)
```
列表规则: ""
查看规则: ""
创建规则: ""
更新规则: ""
删除规则: ""
```

#### 信息内容 (infos)
```
列表规则: ""
查看规则: ""
创建规则: ""
更新规则: ""
删除规则: ""
```

**注意**: 空字符串 `""` 表示允许匿名访问，`null` 表示只有超级用户可以访问。

## 🔐 自动认证功能

### 应用内置认证
应用已配置自动管理员认证功能：
- **认证账户**: `test@example.com`
- **认证密码**: `1234567890`
- **认证时机**: 
  - 应用启动时
  - 更改端口时
  - 每次数据操作前

### 工作原理
1. **自动登录**: 每次连接检查或数据操作时，应用会自动使用内置账户登录
2. **权限获取**: 登录成功后，应用获得超级用户权限
3. **数据访问**: 可以访问所有集合和数据

### 注意事项
- **账户匹配**: 确保 PocketBase 管理员账户与应用内置账户一致
- **密码一致**: 如需修改密码，需同时更新 PocketBase 和应用代码
- **安全提醒**: 生产环境建议使用更安全的认证方式

## 🔧 权限错误处理

### 当前状态
- ✅ **连接正常**: PocketBase 服务运行正常
- ⚠️ **权限限制**: 部分数据需要管理员权限访问

### 解决方案
1. **方案一**: 登录管理员账户
   - 访问 http://localhost:8090/_/
   - 使用管理员账户登录
   - 应用将自动获得数据访问权限

2. **方案二**: 修改集合权限（推荐用于开发）
   - 在管理界面的 Collections 页面
   - 选择相应集合
   - 修改 API 规则为空字符串以允许匿名访问

## 📊 数据结构验证

### 检查必要集合
确认以下集合存在且结构正确：
- `sources` - 信息源
- `focus_points` - 关注点
- `infos` - 信息内容
- `crawled_data` - 爬取数据

### 测试连接
运行测试命令：
```bash
npm run test-pocketbase
```

## 🛠️ 故障排除

### 1. 服务无法启动
- 检查端口 8090 是否被占用
- 查看 PocketBase 日志

### 2. 连接失败
- 确认防火墙设置
- 检查 CSP 策略

### 3. 权限错误
- 登录管理员账户
- 检查集合 API 规则设置

### 4. 数据加载失败
- 确认集合结构正确
- 检查数据格式兼容性

## 📝 日志说明

### 正常日志
- `✅ 已加载 X 个信息源` - 数据加载成功
- `PocketBase 连接成功` - 连接建立成功

### 权限相关日志
- `⚠️ 信息源: 需要管理员权限` - 需要登录管理员
- `🔑 解决方案: 访问 http://localhost:8090/_/` - 提供解决方案链接

### 错误日志
- `❌ 信息源加载失败` - 数据获取失败
- `PocketBase 连接失败` - 服务连接问题

## 🔗 相关链接

- **管理界面**: http://localhost:8090/_/
- **API 文档**: http://localhost:8090/api/
- **健康检查**: http://localhost:8090/api/health
- **PocketBase 官方文档**: https://pocketbase.io/docs/